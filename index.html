<!--
Name:Nailah Lewis
Student ID: 816042748
Course: INFO 1601
Teacher: Nicholas Mendez
Assignment 2
-->


<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="description" content="The Pokemon Site for INFO 1601 A2">
    <meta name="keywords" content="INFO 1601, UWI, Assignment 2">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <title>Poke Dextr</title>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>


    <style>
        body, html{
            height: 100vh;
        }

        #listing{
            overflow-y: scroll;
            max-height: 100%;
        }

        aside, article{
            max-height: 25vh;
        }

        body {
            padding-left: 300px;
        }

        nav{
            height: 70px;
            margin:0;
        }

        @media only screen and (max-width : 992px) {
            body {
                padding-left: 0;
            }
        }

    </style>
</head>



<body>
<ul id="listing" class="sidenav sidenav-fixed collection">
  <a href="#bulbasaur" class="collection-item">Bulbasaur</a>
  <a href="#dugtrio" class="collection-item">Dugtrio</a>
    <!-- Begin List Template -->
    <!-- List items will be added dynamically -->
</ul>

<nav class="teal nav-wrapper row" style="padding:10px; margin-bottom:0;">

    <form onsubmit="event.preventDefault(); getMyPokemon()">
        <div class="col s2">
            <a href="#" data-target="listing" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        </div>

        <div class="col input-field s4" >
            <input placeholder="Student ID" style="border-radius:4px; color:white; background-color:#017c70" name="user_id" id="user_id" type="text">
            <label for="user_id" style="color:white">Student ID</label>
        </div>

        <div class="col s5">
            <button type="submit" class="waves-effect waves-light btn">Load PKMN</button>
        </div>
    </form>
</nav>


<div class="row" style="height:100%; margin:0">
    <article class="col s12 m6 l4" id="result" style="min-height:80%">

        
      

      
        <!-- Pokemon details will be added dynamically -->
    </article>

    <article class="col s12 m6">
        <table style="height:100%">
            <thead>
            <tr>
                <th>Name</th>
                <th>Pokemon</th>
            </tr>
            </thead>

            <tbody id="myPokeListing">
            <!-- My Pokemon list will be added dynamically -->
            </tbody>
        </table>
    </article>
</div>

<!-- Toast Notification -->
<div id="toast-container" class="bottom-left">
    <!-- Notification will be added dynamically -->
</div>


<script>

    const server = "https://pokedextr.beuwi.app";

    document.addEventListener('DOMContentLoaded', function() {
        M.Sidenav.init(document.querySelectorAll('.sidenav'));
        M.Tabs.init(document.querySelectorAll('.tabs'));
        loadListing();
        loadUser();
    });

    function closeNav(){
        M.Sidenav.init(document.querySelector('#listing')).close();
    }

    async function sendRequest(url, method, data){
        const options = {method};
        if(data){
            options.body = JSON.stringify(data);
            options.headers = {'Content-Type':'application/json'};
        }
        let response = await fetch(url, options);
        return response.json();
    }

    function loadUser(){
        let userid = window.localStorage.getItem('user_id');
        if(userid && userid !== ""){
            document.querySelector('#user_id').value = userid;
        }
    }

    //gets the id from the id text field or prompts the user if the field is empty
    function getId(){
        let user_id = document.querySelector('#user_id').value;

        if(!user_id){
            user_id = prompt("Please enter student ID");
            window.localStorage.setItem('user_id', user_id);
            document.querySelector('#user_id').value = user_id;
        }
        return user_id;
    }

    function toast(message){
        M.toast({html: message});
    }

  async function loadListing(){
      // Make an HTTP request for a collection of Pokemon data
      const response = await fetch('https://pokedextr.beuwi.app/pokemon');
      const data = await response.json();
      displayListing(data);
  }



  function displayListing(pokemon){
      let html = '';
      let result = document.querySelector('#listing');
      for(let poke of pokemon){
          html += `<li><a href="javascript:void(0)" onclick="getPokemon(${poke.id})" class="collection-item">${poke.name}</a></li>`;
      }
      result.innerHTML = html;
  }



  async function getPokemon(id){
      // Send an HTTP request for a Pokemon's details
      const response = await fetch(`https://pokedextr.beuwi.app/pokemon/${id}`);
      const data = await response.json();
      displayPokemon(data);
  }


  function displayPokemon(pokemon){
      const resultElement = document.getElementById("result");
      resultElement.innerHTML = `
          <div id="pokemon-detail" class="card col m12 l10 offset-l1" style="margin-top: 20px">
              <div class="card-image" >
                  <img class="teal" src="${pokemon.image}" alt="${pokemon.name} Image">  
              </div>
              <div class="card-content">
                  <span class="card-title"><p>${pokemon.name} # ${pokemon.id}</p></span>
                  <p>Type1: ${pokemon.type1}</p>
                  <p>Weight: ${pokemon.weight}</p>
                  <p>Height: ${pokemon.height}</p>
                  <a onclick="catchPokemon(${pokemon.id})" id="catchBtn" style="position:absolute; right:15px; bottom:80px"  class="btn-floating btn-large waves-effect waves-light red">
                      <span class="iconify" style="font-size:40px; margin-top:8px" data-icon="mdi-pokeball" data-inline="false"></span>
                  </a>
              </div>
          </div>
      `;
  }

      </script>

      <script src="https://code.iconify.design/1/1.0.4/iconify.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
      <script src="default.js"></script>
      <script src="main.js"></script>

      </body>
      </html>


